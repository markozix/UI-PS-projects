package state;

import java.awt.event.ActionEvent;
import java.awt.event.MouseEvent;
import java.io.BufferedWriter;
import java.io.File;
import java.io.FileNotFoundException;
import java.io.FileWriter;
import java.io.IOException;
import java.io.PrintWriter;

import main.MainFrame;
import modeli.Atribut;

public class UpdateState extends State {

	@Override
	public void selectedField() {
		
	}

	@Override
	public void pressButton(ActionEvent e) {
		int row = MainFrame.getInstance().getTrenutnaTabela().getSelectedRow();
		int brAtributa = MainFrame.getInstance().getTrenutniEntitet().getChildCount();
		String[] vrednosti = new String[brAtributa];
		for(int i = 0; i <  brAtributa; i++) {
			vrednosti[i] = (String)MainFrame.getInstance().getTrenutnaTabela().getValueAt(row, i);
		}
		String fileName = MainFrame.getInstance().getTrenutniEntitet().getEntPaket().getNaziv() + "-"
				+ MainFrame.getInstance().getTrenutniEntitet().getName() + ".dtp";
		File datotekaPromena = new File(fileName);
		StringBuilder sb = new StringBuilder();
		for(int i = 0; i < brAtributa; i++) {
			Atribut atr = (Atribut)MainFrame.getInstance().getTrenutniEntitet().getChildAt(i);
			sb.append(vrednosti[i]);
		}
		sb.append("U");
		sb.append("\r\n");
		for(int i = 0; i < MainFrame.getInstance().getTrenutniEntitet().getChildCount(); i++) {
			String str = MainFrame.getInstance().getLista().get(i).getText();
			Atribut atr = (Atribut)MainFrame.getInstance().getTrenutniEntitet().getChildAt(i);
			int len = atr.getDuzina();
			sb.append(str);
			if(str.length() == len) {
				
			} else {
				for(int j = 0; j < len - str.length(); j++) {
					sb.append(" ");
				}
			}
		}
		try {
			FileWriter fw = new FileWriter(fileName, true);
			BufferedWriter bw = new BufferedWriter(fw);
			PrintWriter pw = new PrintWriter(bw);
			pw.println(sb.toString());
			pw.close();
		} catch (FileNotFoundException e1) {
			e1.printStackTrace();
		} catch (IOException e1) {
			e1.printStackTrace();
		}
	}

}
