package controller.state;

import java.awt.BorderLayout;
import java.awt.Dimension;
import java.awt.event.ActionEvent;
import java.awt.event.ActionListener;

import javax.swing.JPanel;
import javax.swing.JScrollPane;
import javax.swing.JTable;

import main.MainFrame;
import modeli.Atribut;
import modeli.Entitet;
import modeli.InformacioniResurs;
import modeli.Paket;
import modeli.Relacija;
import modeli.Tabela;
import modeli.Workspace;

public class RelacijaStateAction implements ActionListener {
	private JTable tabela;

	@Override
	public void actionPerformed(ActionEvent arg0) {
		MainFrame.getInstance().getTrenutniEntitet().getStateManager().setRelacijaState();
		MainFrame.getInstance().getTrenutnaTabela().addMouseListener(new FieldSelected());
		// ocisti prethodne tabove da ne bi bilo duplikata
		MainFrame.getInstance().getDonjiTabovi().removeAll();
		Entitet trenutni = MainFrame.getInstance().getTrenutniEntitet();
		Paket pp = trenutni.getEntPaket();

		for (Relacija rel : trenutni.getRelacije()) {
			for (Entitet ent : pp.getEntiteti()) {
				if (rel.getEntitet().equals(ent.getName())) {
					// donja tabela
					int t = ent.getChildCount();
					Object[] lista = new Object[t];
					for (int k = 0; k < t; k++) {
						Atribut aa = (Atribut) ent.getChildAt(k);
						String s = aa.getName();
						Object p = s;
						lista[k] = p;
					}
					// JTable tabela = new JTable(new Tabela(null, lista));
					JPanel panel = new JPanel();
					BorderLayout bl = new BorderLayout();
					panel.setLayout(bl);
					// tabela = new JTable(null, lista);
					tabela = new JTable(new Tabela(null, lista));
					tabela.getTableHeader();
					panel.add(tabela);
					JScrollPane scroll = new JScrollPane(tabela);
					Dimension screenSize = MainFrame.getInstance().getGornji().getSize();
					scroll.setPreferredSize(screenSize);
					scroll.setMaximumSize(screenSize);
					scroll.setMinimumSize(screenSize);
					tabela.setFillsViewportHeight(true);
					panel.add(scroll);
					MainFrame.getInstance().getDonjiTabovi().addTab(
							MainFrame.getInstance().getTrenutniEntitet().getEntPaket().getNaziv() + ":" + ent.getName(),
							panel);
				}
			}
		}
	}

}
